#!/usr/bin/env python
# encoding: utf-8
# Date: 2023/02/07
# file: 获取所有退出人员id列表.py
# Email:
# Author: rakiwine

import re
from Study.pythonReview.a0_complex.database.MysqlModel import MysqlModel
import pymysql

_list = []

with open("../game-out.log", "r", buffering=-1, encoding="UTF-8") as f:
    for line in f:
        line = line.strip("\n")

        if "standAndExitDebug game-server-2 userGameQuit" in line:
            _list.append(line)

print(len(_list))

pattern = re.compile(r"standAndExitDebug game-server-2 userGameQuit ([\d]{1,}) ([\d]{1,})")

# ret = pattern.search("[2023-02-07 09:30:32.487] [INFO] console - noJettonAIArr game-server-1 userGameQuit 277916576169066496 1561630607300235280 201 200")
# print(ret.groups()[1])

gameUserIdListDIct = {}
for line in _list:
    try:

        ret = pattern.search(line)

        gameId = ret.groups()[0]
        userId = ret.groups()[1]

        if gameUserIdListDIct.get(gameId, None) is not None:
            gameUserIdListDIct[gameId].append(userId)
        else:
            gameUserIdListDIct[gameId] = [userId]
    except:
        # print(line)
        pass

gameId = list(gameUserIdListDIct.keys())[0]
useridList = list(gameUserIdListDIct.values())[0]

quitList = ['1561630607237320737', '1561630607237320752', '1561630607237320763', '1561630607237320734', '1561630607233126453', '1561630607233126434', '1561630607237320729', '1561630607237320741', '1561630607233126409', '1561630607237320711', '1561630607237320763', '1561630607237320760', '1561630607233126419', '1561630607233126441', '1561630607237320771', '1561630607237320715', '1561630607233126453', '1561630607237320767', '1561630607237320743', '1561630607237320749', '1561630607237320765', '1561630607233126441', '1561630607233126444', '1561630607237320768', '1561630607237320718', '1561630607237320761', '1561630607233126425', '1561630607237320758', '1561630607233126438', '1561630607237320715', '1561630607237320738', '1561630607233126408', '1561630607237320740', '1561630607237320721', '1561630607237320760', '1561630607237320720', '1561630607233126439', '1561630607233126420', '1561630607237320766', '1561630607237320746', '1561630607237320733', '1561630607237320742', '1561630607233126418', '1561630607233126442', '1561630607237320770', '1561630607237320720', '1561630607237320762', '1561630607233126420', '1561630607237320739', '1561630607237320722', '1561630607237320704', '1561630607233126450', '1561630607233126452', '1561630607237320708', '1561630607233126447', '1561630607237320734', '1561630607237320718', '1561630607237320743', '1561630607237320725', '1561630607237320759', '1561630607237320738', '1561630607237320769', '1561630607237320732', '1561630607237320740', '1561630607233126449', '1561630607237320753', '1561630607237320719', '1561630607237320716', '1561630607233126446', '1561630607237320726', '1561630607237320749', '1561630607237320748', '1561630607237320769', '1561630607237320757', '1561630607237320728', '1561630607233126450', '1561630607233126419', '1561630607237320767', '1561630607237320704', '1561630607237320729', '1561630607233126442', '1561630607233126422', '1561630607237320736', '1561630607237320716', '1561630607237320771', '1561630607237320773', '1561630607237320742', '1561630607233126408', '1561630607233126409', '1561630607233126410', '1561630607237320761', '1561630607237320714', '1561630607233126438', '1561630607237320709', '1561630607237320727', '1561630607237320745', '1561630607237320776']
allTuple = (('1561630607237320751',), ('1561630607237320767',), ('1561630607237320759',), ('1561630607237320766',), ('1561630607233126401',), ('1561630607233126401',), ('1561630607237320757',), ('1561630607237320762',), ('1561630607237320754',), ('1561630607237320770',), ('1561630607233126404',), ('1561630607233126404',), ('1561630607237320768',), ('1561630607237320765',), ('1561630607237320758',), ('1561630607237320750',), ('1561630607237320757',), ('1561630607237320768',), ('1561630607233126408',), ('1561630607233126408',), ('1561630607233126409',), ('1561630607233126409',), ('1561630607233126410',), ('1561630607233126410',), ('1561630607233126411',), ('1561630607233126411',), ('1561630607237320771',), ('1561630607237320771',), ('1561630607237320743',), ('1561630607237320742',), ('1561630607237320767',), ('1561630607237320753',), ('1561630607237320760',), ('1561630607237320760',), ('1561630607233126416',), ('1561630607233126416',), ('1561630607237320751',), ('1561630607237320763',), ('1561630607233126418',), ('1561630607233126418',), ('1561630607233126419',), ('1561630607233126419',), ('1561630607233126420',), ('1561630607233126420',), ('1561630607237320762',), ('1561630607237320756',), ('1561630607233126422',), ('1561630607233126422',), ('1561630607233126423',), ('1561630607233126423',), ('1561630607233126424',), ('1561630607233126424',), ('1561630607233126425',), ('1561630607233126425',), ('1561630607237320764',), ('1561630607237320769',), ('1561630607237320745',), ('1561630607237320747',), ('1561630607237320746',), ('1561630607237320741',), ('1561630607237320741',), ('1561630607237320743',), ('1561630607237320776',), ('1561630607237320750',), ('1561630607233126431',), ('1561630607233126431',), ('1561630607237320759',), ('1561630607237320758',), ('1561630607233126433',), ('1561630607233126433',), ('1561630607233126434',), ('1561630607233126434',), ('1561630607233126435',), ('1561630607233126435',), ('1561630607233126436',), ('1561630607233126436',), ('1561630607237320752',), ('1561630607237320761',), ('1561630607233126438',), ('1561630607233126438',), ('1561630607233126439',), ('1561630607233126439',), ('1561630607233126440',), ('1561630607233126440',), ('1561630607233126441',), ('1561630607233126441',), ('1561630607233126442',), ('1561630607233126442',), ('1561630607233126443',), ('1561630607233126443',), ('1561630607233126444',), ('1561630607233126444',), ('1561630607237320761',), ('1561630607237320754',), ('1561630607233126446',), ('1561630607233126446',), ('1561630607233126447',), ('1561630607233126447',), ('1561630607237320764',), ('1561630607237320765',), ('1561630607233126449',), ('1561630607233126449',), ('1561630607233126450',), ('1561630607233126450',), ('1561630607233126451',), ('1561630607233126451',), ('1561630607233126452',), ('1561630607233126452',), ('1561630607233126453',), ('1561630607233126453',), ('1561630607237320763',), ('1561630607237320766',), ('1561630607237320744',), ('1561630607237320742',), ('1561630607237320740',), ('1561630607237320746',), ('1561630607237320745',), ('1561630607237320747',), ('1561630607237320769',), ('1561630607237320770',), ('1561630607237320744',), ('1561630607237320740',), ('1561630607237320739',), ('1561630607237320739',), ('1561630607237320773',), ('1561630607237320773',), ('1561630607237320753',), ('1561630607237320704',), ('1561630607237320704',), ('1561630607237320752',), ('1561630607237320749',), ('1561630607237320756',), ('1561630607237320749',), ('1561630607237320748',), ('1561630607237320748',), ('1561630607237320708',), ('1561630607237320708',), ('1561630607237320709',), ('1561630607237320709',), ('1561630607237320710',), ('1561630607237320710',), ('1561630607237320711',), ('1561630607237320711',), ('1561630607237320712',), ('1561630607237320712',), ('1561630607237320713',), ('1561630607237320713',), ('1561630607237320714',), ('1561630607237320714',), ('1561630607237320715',), ('1561630607237320715',), ('1561630607237320716',), ('1561630607237320716',), ('1561630607237320717',), ('1561630607237320717',), ('1561630607237320718',), ('1561630607237320718',), ('1561630607237320719',), ('1561630607237320719',), ('1561630607237320720',), ('1561630607237320720',), ('1561630607237320721',), ('1561630607237320721',), ('1561630607237320722',), ('1561630607237320722',), ('1561630607237320723',), ('1561630607237320723',), ('1561630607237320724',), ('1561630607237320724',), ('1561630607237320725',), ('1561630607237320725',), ('1561630607237320726',), ('1561630607237320726',), ('1561630607237320727',), ('1561630607237320727',), ('1561630607237320728',), ('1561630607237320728',), ('1561630607237320729',), ('1561630607237320729',), ('1561630607237320730',), ('1561630607237320730',), ('1561630607237320731',), ('1561630607237320731',), ('1561630607237320732',), ('1561630607237320732',), ('1561630607237320733',), ('1561630607237320733',), ('1561630607237320734',), ('1561630607237320734',), ('1561630607237320735',), ('1561630607237320735',), ('1561630607237320736',), ('1561630607237320736',), ('1561630607237320737',), ('1561630607237320737',), ('1561630607237320738',), ('1561630607237320738',), ('183266624713785344',), ('158585539929309184',))
allList = ['1561630607237320751', '1561630607237320767', '1561630607237320759', '1561630607237320766', '1561630607233126401', '1561630607233126401', '1561630607237320757', '1561630607237320762', '1561630607237320754', '1561630607237320770', '1561630607233126404', '1561630607233126404', '1561630607237320768', '1561630607237320765', '1561630607237320758', '1561630607237320750', '1561630607237320757', '1561630607237320768', '1561630607233126408', '1561630607233126408', '1561630607233126409', '1561630607233126409', '1561630607233126410', '1561630607233126410', '1561630607233126411', '1561630607233126411', '1561630607237320771', '1561630607237320771', '1561630607237320743', '1561630607237320742', '1561630607237320767', '1561630607237320753', '1561630607237320760', '1561630607237320760', '1561630607233126416', '1561630607233126416', '1561630607237320751', '1561630607237320763', '1561630607233126418', '1561630607233126418', '1561630607233126419', '1561630607233126419', '1561630607233126420', '1561630607233126420', '1561630607237320762', '1561630607237320756', '1561630607233126422', '1561630607233126422', '1561630607233126423', '1561630607233126423', '1561630607233126424', '1561630607233126424', '1561630607233126425', '1561630607233126425', '1561630607237320764', '1561630607237320769', '1561630607237320745', '1561630607237320747', '1561630607237320746', '1561630607237320741', '1561630607237320741', '1561630607237320743', '1561630607237320776', '1561630607237320750', '1561630607233126431', '1561630607233126431', '1561630607237320759', '1561630607237320758', '1561630607233126433', '1561630607233126433', '1561630607233126434', '1561630607233126434', '1561630607233126435', '1561630607233126435', '1561630607233126436', '1561630607233126436', '1561630607237320752', '1561630607237320761', '1561630607233126438', '1561630607233126438', '1561630607233126439', '1561630607233126439', '1561630607233126440', '1561630607233126440', '1561630607233126441', '1561630607233126441', '1561630607233126442', '1561630607233126442', '1561630607233126443', '1561630607233126443', '1561630607233126444', '1561630607233126444', '1561630607237320761', '1561630607237320754', '1561630607233126446', '1561630607233126446', '1561630607233126447', '1561630607233126447', '1561630607237320764', '1561630607237320765', '1561630607233126449', '1561630607233126449', '1561630607233126450', '1561630607233126450', '1561630607233126451', '1561630607233126451', '1561630607233126452', '1561630607233126452', '1561630607233126453', '1561630607233126453', '1561630607237320763', '1561630607237320766', '1561630607237320744', '1561630607237320742', '1561630607237320740', '1561630607237320746', '1561630607237320745', '1561630607237320747', '1561630607237320769', '1561630607237320770', '1561630607237320744', '1561630607237320740', '1561630607237320739', '1561630607237320739', '1561630607237320773', '1561630607237320773', '1561630607237320753', '1561630607237320704', '1561630607237320704', '1561630607237320752', '1561630607237320749', '1561630607237320756', '1561630607237320749', '1561630607237320748', '1561630607237320748', '1561630607237320708', '1561630607237320708', '1561630607237320709', '1561630607237320709', '1561630607237320710', '1561630607237320710', '1561630607237320711', '1561630607237320711', '1561630607237320712', '1561630607237320712', '1561630607237320713', '1561630607237320713', '1561630607237320714', '1561630607237320714', '1561630607237320715', '1561630607237320715', '1561630607237320716', '1561630607237320716', '1561630607237320717', '1561630607237320717', '1561630607237320718', '1561630607237320718', '1561630607237320719', '1561630607237320719', '1561630607237320720', '1561630607237320720', '1561630607237320721', '1561630607237320721', '1561630607237320722', '1561630607237320722', '1561630607237320723', '1561630607237320723', '1561630607237320724', '1561630607237320724', '1561630607237320725', '1561630607237320725', '1561630607237320726', '1561630607237320726', '1561630607237320727', '1561630607237320727', '1561630607237320728', '1561630607237320728', '1561630607237320729', '1561630607237320729', '1561630607237320730', '1561630607237320730', '1561630607237320731', '1561630607237320731', '1561630607237320732', '1561630607237320732', '1561630607237320733', '1561630607237320733', '1561630607237320734', '1561630607237320734', '1561630607237320735', '1561630607237320735', '1561630607237320736', '1561630607237320736', '1561630607237320737', '1561630607237320737', '1561630607237320738', '1561630607237320738', '183266624713785344', '158585539929309184']

real = []
for item in allList:
    if item in quitList:
        pass
    else:
        real.append(item)

print(len(set(allList)))
print(len(allList))
print(len(real))

# try:
#     _username = "root"
#     _password = "Root_123"
#
#     _host = "120.79.60.207"
#     _database = "poker"
#     mysql = MysqlModel(_username, _password, _host, _database)
#     results = mysql.select_mysql("select userId from `GameAndUser` where gameId = {}".format("278149435869888512"))
#     print(results)
# except pymysql.err.ProgrammingError as e:
#     print("Exception Error is %s" % (e))
# except pymysql.err.OperationalError as e:
#     print("Exception Error is %s" % (e))
